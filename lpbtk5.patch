From 4218dc6ddcdbe19c207bf1ee94dae68cb09db59e Mon Sep 17 00:00:00 2001
From: sonicxml <sonicxml@gmail.com>
Date: Sat, 21 Jul 2012 20:04:00 -0400
Subject: [PATCH] dont kill multiple apps if user presses back too long -
 sethyx

---
 .../com/android/internal/policy/impl/PhoneWindowManager.java    |    7 +++++--
 1 file changed, 5 insertions(+), 2 deletions(-)

diff --git a/policy/src/com/android/internal/policy/impl/PhoneWindowManager.java b/policy/src/com/android/internal/policy/impl/PhoneWindowManager.java
index 4a5b522..a610573 100755
--- a/policy/src/com/android/internal/policy/impl/PhoneWindowManager.java
+++ b/policy/src/com/android/internal/policy/impl/PhoneWindowManager.java
@@ -516,7 +516,8 @@ public void onInputEvent(InputEvent event) {
     ShortcutManager mShortcutManager;
     PowerManager.WakeLock mBroadcastWakeLock;
     boolean mHavePendingMediaKeyRepeatWithWakeLock;
-
+    
+    boolean mBackJustKilled;
     // Fallback actions by key code.
     private final SparseArray<KeyCharacterMap.FallbackAction> mFallbackActions =
             new SparseArray<KeyCharacterMap.FallbackAction>();
@@ -786,6 +787,7 @@ public void run() {
 			}
                         break;
                     }
+                    mBackJustKilled = false;
                 }
             } catch (RemoteException remoteException) {
                 // Do nothing; just let it go.
@@ -1932,8 +1934,9 @@ public long interceptKeyBeforeDispatching(WindowState win, KeyEvent event, int p
 	} else if (keyCode == KeyEvent.KEYCODE_BACK) {
             	if (Settings.Secure.getInt(mContext.getContentResolver(),
 			Settings.Secure.KILL_APP_LONGPRESS_BACK, 0) == 1) {
-                	if (down && repeatCount == 0) {
+                	if (!mBackJustKilled && down && repeatCount == 0) {
                     		mHandler.postDelayed(mBackLongPress, ViewConfiguration.getGlobalActionKeyTimeout());
+				mBackJustKilled = true;
                 	}
 		}
         } else if (keyCode == KeyEvent.KEYCODE_ASSIST) {
-- 
1.7.10

